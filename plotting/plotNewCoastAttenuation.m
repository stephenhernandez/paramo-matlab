clear; close all; clc;
cd ~/research/now/magnitudeAttenuationCurve/
load recomputeMagnitudes.mat

tStart = datetime(2015,10,01);
tEnd = datetime(2018,09,15);
minMag = 0;
printFlag = 0;
minLon = -84; maxLon = -74; minLat = -6.; maxLat = 4;
%minLon = -92; maxLon = -89; minLat = -2.; maxLat = 2;
formatFlag = false;
tI = lat <= maxLat & lat >= minLat & lon <= maxLon & lon >= minLon & newMag >= minMag & depth < 50 & t >= tStart & t <= tEnd;
t = t(tI);

origlat = origlat(tI);
origlaterr = origlaterr(tI);
origlon = origlon(tI);
origlonerr = origlonerr(tI);
origMag = origMag(tI);
newMag = newMag(tI);
newMagErr = newMagErr(tI);
origrms = origrms(tI);
origdepth = origdepth(tI);
origdeptherr = origdeptherr(tI);
nMLv = nMLv(tI);
ids = ids(tI);
usedPhases = usedPhases(tI);
newMag = round(newMag*100)/100;
oldNewMag = newMag;

changeID = {"igepn2016hnmu","igepn2016hobd","igepn2016htqh","igepn2016htqj","igepn2016hwwk",...
    "igepn2016hwwy","igepn2016jste","igepn2016jtkp","igepn2016nmyn","igepn2016nmyx",...
    "igepn2017mspb","igepn2017xqtl"};
%new_mag = [7.8 6.0 6.0 6.1 6.0 5.9 6.7 6.9 5.9 6.3 6.0 6.2]; %Mw
new_mag = [7.8 5.8 6.2 6. 6.0 5.9 6.7 6.9 5.9 6.3 6.0 6.1]; %NEIC

for j = 1:length(changeID)
    id_ = changeID{j};
    [lia,locb] = ismember(id_,ids);
    if lia
        disp(j);
        newMag(locb) = new_mag(j);
    else
        disp('what the heck. something went wrong.');
    end
end

[~,tI] = sort(t);
t = t(tI);
origlat = origlat(tI);
origlaterr = origlaterr(tI);
origlon = origlon(tI);
origlonerr = origlonerr(tI);
origMag = origMag(tI); origMag = round(origMag*100)/100;
newMag = newMag(tI);
newMagErr = newMagErr(tI);
origrms = origrms(tI);
origdepth = origdepth(tI);
origdeptherr = origdeptherr(tI);
nMLv = nMLv(tI);
ids = ids(tI);
usedPhases = usedPhases(tI);
oldNewMag = oldNewMag(tI);

writeFlag = true;

%%
tic;
tI = true(size(t));
close all;
plotFinalDiagnostics2(t(tI),origMag(tI),nMLv(tI),origlon(tI),origlat(tI),...
    newMag(tI),newMagErr(tI),usedPhases(tI),origdepth(tI),minLon,minLat,maxLon,maxLat,printFlag,formatFlag);
toc;

%% plot focal mechanisms
% mts = [-79.89 0.79 19 5.88 0.19 -6.07 3.75 -8.54 -1.48 25;...% X Y 040976A
% -80.46 0.59 18 2.75 0.15 -2.90 0.55 -2.97 -0.48 24;...% X Y 030179A
% -79.71 1.93 15 0.66 0.04 -0.70 0.28 -1.01 -0.16 25;...% X Y 123179C
% -80.32 1.95 15 0.12 -1.36 1.24 0.85 0.82 0.98 24;...% X Y 051180C
% -80.11 -1.72 76 5.00 -2.17 -2.83 -7.91 -0.19 -3.51 24;...% X Y 081880A
% -79.37 0.93 15 -6.93 4.37 2.56 3.71 -0.74 5.74 24;...% X Y 010281A
% -79.31 1.72 15 -2.10 1.13 0.97 1.20 0.41 1.43 24;...% X Y 010781B
% -80.97 -1.99 17 3.22 -0.42 -2.81 0.87 -4.55 0.81 25;...% X Y 050681A
% -79.99 0.31 35 0.96 0.05 -1.01 0.49 -1.23 -0.25 26;...% X Y 112283B
% -80.06 0.44 40 2.51 -0.16 -2.35 0.07 -2.88 -0.77 23;...% X Y 011986A
% -79.92 0.81 16 2.21 0.14 -2.35 0.51 -2.40 -0.48 25;...% X Y 062589B
% -79.53 1.92 15 -3.64 0.96 2.67 2.62 1.48 0.06 24;...% X Y 090989A
% -80.58 -0.15 21 1.88 0.12 -2.00 0.37 -1.62 -0.30 25;...% X Y 090290A
% -80.96 -0.86 16 0.81 -0.17 -0.65 0.61 -1.44 -0.27 24;...% X Y 080491A
% -80.97 -0.39 27 1.10 0.00 -1.10 0.33 -1.91 -0.25 24;...% X Y 121696A
% -81.07 -1.65 34 4.26 0.81 -5.07 -1.10 -4.50 0.87 23;...% X Y 070198C
% -80.48 -0.57 26 2.59 0.16 -2.76 0.98 -5.67 -0.52 26;...% X Y 080498H
% -81.95 1.76 46 0.41 -1.76 1.35 -2.90 -0.30 -4.27 23;...% X Y 082200A
% -80.55 -2.00 58 0.88 -1.32 0.44 0.05 0.85 1.57 24;...% X Y 092000C
% -80.74 -0.32 15 1.80 -0.10 -1.70 0.96 -4.06 -0.52 25;...% X Y 092800B
% -79.96 0.69 34 0.71 0.38 -1.09 0.24 -0.91 -0.16 24;...% X Y 060104C
% -80.74 -0.88 33 3.47 0.17 -3.63 -0.23 -3.51 -0.49 23;...% X Y 112404B
% -81.06 -1.24 12 0.92 0.09 -1.00 -0.08 -1.28 0.00 24;...% X Y 200501210430A
% -81.05 -1.23 12 0.68 0.03 -0.71 0.06 -0.98 0.00 25;...% X Y 200501211345A
% -81.17 -1.26 14 3.03 -0.00 -3.03 0.29 -2.38 0.68 23;...% X Y 200501211647A
% -80.93 -1.25 19 2.88 0.05 -2.92 0.87 -5.19 -0.17 23;...% X Y 200501220112A
% -80.89 -1.30 24 1.19 2.33 -3.52 -0.10 -2.03 0.61 23;...% X Y 200501231006A
% -80.95 -1.53 16 0.86 0.05 -0.91 0.11 -1.52 -0.02 25;...% X Y 200501242323A
% -80.94 -1.65 31 5.65 -0.44 -5.21 0.57 -3.09 -0.22 24;...% X Y 200501242326A
% -81.11 -1.61 26 2.77 0.33 -3.10 0.11 -3.99 0.82 23;...% X Y 200501242359A
% -81.39 -1.22 12 0.79 -0.03 -0.75 -0.02 -0.93 -0.09 25;...% X Y 200501280926A
% -81.20 -1.10 12 0.56 0.01 -0.57 0.03 -0.74 -0.04 25;...% X Y 200501281546A
% -81.20 -0.96 12 1.98 0.15 -2.13 0.31 -3.35 -0.61 24;...% X Y 200501300706A
% -81.30 -1.80 14 1.48 -0.01 -1.48 0.03 -1.66 -0.03 24;...% X Y 200502172042A
% -80.85 -1.27 20 3.97 1.01 -4.98 -0.79 -4.02 0.48 23;...% X Y 200503270803A
% -80.11 0.64 28 3.89 0.06 -3.96 -0.65 -2.70 -0.06 23;...% X Y 200712101819A
% -80.36 -1.98 48 4.27 -1.56 -2.71 -1.47 1.38 2.04 23;...% X Y 200807180541A
% -80.44 -1.78 28 0.84 -0.06 -0.78 -0.09 1.05 -1.25 24;...% X Y 200907190835A
% -80.64 -1.27 34 0.83 0.07 -0.90 0.05 -0.35 -0.12 24;...% X Y 201002281026A
% -80.07 0.43 26 0.61 0.06 -0.66 -0.02 -1.11 -0.46 24;...% X Y 201011250419A
% -81.70 -1.85 23 -0.84 -0.79 1.63 -0.12 1.02 4.09 23;...% X Y 201105120236A
% -81.75 -1.88 16 -0.16 -0.06 0.22 0.05 0.19 1.16 25;...% X Y 201111170157A
% -80.81 -0.80 37 4.41 1.05 -5.45 -0.21 -3.02 -1.24 23;...% X Y 201201101807A
% -79.39 0.47 56 4.41 -5.74 1.33 6.14 1.64 2.15 23;...% X Y 201202081054A
% -81.65 -1.77 18 -0.04 0.49 -0.44 0.17 1.44 3.00 23;...% X Y 201206080419A
% -81.72 -1.86 12 -5.36 0.45 4.92 1.53 1.36 0.87 23;...% X Y 201211130156A
% -79.49 1.67 15 1.07 0.03 -1.10 -0.05 -3.18 -0.44 24;...% X Y 201403092029A
% -79.52 1.73 16 1.68 -0.00 -1.68 -0.14 -4.54 -0.50 24;...% X Y 201406160639A
% -79.70 1.24 24 0.90 0.11 -1.01 -0.02 -1.29 -0.35 24;...% X Y 201505300626A

%figure('units','normalized','outerposition',[0 0 1 1]);
%load ~/igdata/ec_boundaries.mat;
%plot(lonEC,latEC,'k-','linewidth',2); axis equal;
%axis([minLon maxLon minLat maxLat]);
%hold on;

mts = [-80.69 -1.43 36 -3.58 0.48 3.11 -0.72 -0.72 0.32 23;...% X Y 201603060054A
    -80.25 -0.12 22 3.41 0.03 -3.44 1.22 -4.65 -0.64 27;...% X Y 201604162358A
    -80.70 -0.51 37 1.30 -0.39 -0.92 0.05 -0.51 -0.06 25;...% X Y 201604170713A
    -81.03 -0.30 18 3.00 -0.54 -2.46 -0.55 -3.40 -0.38 24;...% X Y 201604170923A
    -81.00 -1.07 12 1.13 0.06 -1.19 0.03 -1.51 -0.00 24;...% X Y 201604181838A
    -80.91 -0.03 12 0.21 0.64 -0.85 0.44 0.17 0.46 24;...% X Y 201604182115A
    -81.00 -0.26 13 2.25 -0.21 -2.05 -0.53 -2.40 -0.47 23;...% X Y 201604190203A
    -81.08 -1.16 19 2.36 0.13 -2.50 -0.77 -2.13 0.01 23;...% X Y 201604191712A
    -80.28 0.50 14 2.23 0.00 -2.23 -0.02 -3.43 -0.26 24;...% X Y 201604192222A
    -80.57 0.62 12 0.71 0.00 -0.71 -0.19 -1.25 -0.16 25;...% X Y 201604200833A
    -80.36 0.57 22 1.25 -0.19 -1.06 0.03 -1.02 -0.22 25;...% X Y 201604200833B
    -80.28 0.60 28 3.32 -0.24 -3.09 -0.18 -3.16 -0.29 23;...% X Y 201604202130A
    -80.76 -0.34 13 0.63 0.02 -0.65 0.07 -1.10 -0.13 25;...% X Y 201604220303A
    -80.85 -0.38 15 5.01 -0.32 -4.70 -0.16 -6.88 -0.51 24;...% X Y 201604220320A
    -80.82 -0.38 23 3.75 -0.69 -3.06 -0.13 -3.12 -0.71 23;...% X Y 201604220431A
    -80.95 -0.29 15 2.23 -0.19 -2.04 -0.23 -5.97 0.27 23;...% X Y 201604220852A
    -80.56 0.69 12 2.10 -0.16 -1.93 -2.01 -2.87 -0.61 24;...% X Y 201604230124A
    -81.07 -0.14 12 0.58 0.01 -0.59 -0.41 -0.87 -0.19 24;...% X Y 201604262158A
    -80.04 0.43 27 0.68 0.04 -0.73 0.19 -1.20 -0.15 26;...% X Y 201605180757A
    -80.02 0.30 34 1.39 0.10 -1.48 0.37 -2.02 -0.32 26;...% X Y 201605181646A
    -80.53 0.10 12 -5.28 1.34 3.94 0.37 -1.64 -2.17 23;...% X Y 201606011005A
    -80.56 0.06 17 -2.50 0.64 1.86 -0.46 0.40 -0.90 23;...% X Y 201606011500A
    -79.79 0.84 18 -1.34 1.96 -0.62 0.23 2.11 0.85 23;...% X Y 201607060619A
    -81.21 -0.43 12 0.73 0.09 -0.81 -0.10 -1.43 0.01 24;...% X Y 201607080428A
    -80.06 0.48 34 0.61 0.04 -0.65 0.10 -0.73 -0.11 25;...% X Y 201607110201A
    -80.00 0.58 30 2.22 0.24 -2.45 0.47 -3.20 -0.53 25;...% X Y 201607110211A
    -80.64 -1.11 12 2.64 -0.24 -2.40 0.56 -0.94 0.09 23;...% X Y 201607200120A
    -80.68 -0.92 31 1.64 -0.15 -1.50 -0.05 -1.68 -0.18 23;...% X Y 201608260425A
    -80.01 0.84 12 3.94 -0.64 -3.30 -0.01 -3.79 -0.73 23;...% X Y 201612121553A
    -79.80 0.93 12 1.40 -0.77 -0.63 -1.33 -0.31 -0.60 24;...% X Y 201612190711A
    -80.07 0.66 15 0.23 -0.08 -0.15 0.75 -0.80 -0.12 24;...% X Y 201612201049A
    -79.98 0.90 12 2.71 -0.64 -2.06 -1.13 -1.75 -0.63 23;...% X Y 201612201739A
    -80.27 0.69 27 2.44 0.24 -2.68 -0.49 -2.99 -0.33 23;...% X Y 201701110236A
    -79.85 0.64 23 0.89 0.16 -1.04 0.28 -1.36 -0.23 24;...% X Y 201701311422A
    -80.73 -0.36 14 0.71 0.03 -0.74 0.00 -1.06 -0.13 25;...% X Y 201706302229A
    -79.90 0.67 24 0.98 0.16 -1.14 0.20 -1.36 -0.24 24;...% X Y 201707111209A
    -80.12 -1.97 85 0.81 -0.78 -0.02 -1.43 1.45 -0.85 23;...% X Y 201711280204A
    -80.60 -0.58 29 1.29 0.15 -1.44 0.28 -2.03 -0.22 25]; %...% X Y 201712031119A

%% this section works, but is slow to run
% cmap = parula(512);
% depths_ = mts(:,3);
% minDepth = 0;
% maxDepth = 35;
% dumDepth = linspace(minDepth,maxDepth,length(cmap));
% for i = 1:size(mts,1)
%     figure(2); 
%     %subplot(121);
%     hold on;
%     ax = gca;
%     M = mts(i,4:9);
%     [~,m0] = mt2mw(M);
%     exponent = mts(i,10);
%     m0 = m0*1e-28*10^exponent;
%     mw = m02mw(m0);
%     if mw >= -5.5
%         r_ = interp1(dumDepth,cmap(:,1),depths_(i)); %,'linear',cmap(end,1));
%         g_ = interp1(dumDepth,cmap(:,2),depths_(i)); %,'linear',cmap(end,2)); %,maxDepth);
%         b_ = interp1(dumDepth,cmap(:,3),depths_(i)); %,'linear',cmap(end,3)); %,maxDepth);
%         focalmech(ax,M,mts(i,1),mts(i,2),0.05*mw); %,[r_ g_ b_]); %axis equal;
%     end
% end
% 
% axis([minLon maxLon minLat maxLat]);
